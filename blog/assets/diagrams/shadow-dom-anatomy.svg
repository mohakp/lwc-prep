<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 960 760" width="960" height="760" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <style>
      .title       { font-size: 17px; font-weight: 700; fill: #ffffff; }
      .subtitle    { font-size: 11px; fill: #c8e0f8; }
      .label       { font-size: 13px; font-weight: 600; fill: #0d1117; }
      .label-sm    { font-size: 11px; fill: #495057; }
      .code        { font-size: 12px; font-family: 'Cascadia Code','Consolas',monospace; fill: #0d1117; }
      .code-blue   { font-size: 12px; font-family: 'Cascadia Code','Consolas',monospace; fill: #0070d2; }
      .code-purple { font-size: 12px; font-family: 'Cascadia Code','Consolas',monospace; fill: #7e3af2; }
      .code-green  { font-size: 12px; font-family: 'Cascadia Code','Consolas',monospace; fill: #1e7e34; }
      .code-orange { font-size: 12px; font-family: 'Cascadia Code','Consolas',monospace; fill: #d63031; }
      .note        { font-size: 11px; fill: #6c757d; font-style: italic; }
      .tag-label   { font-size: 11px; font-weight: 700; fill: #ffffff; }
      .section-h   { font-size: 13px; font-weight: 700; fill: #0d1117; }
      .key-label   { font-size: 12px; font-weight: 600; fill: #0d1117; }
      .key-desc    { font-size: 11px; fill: #495057; }
    </style>
    <marker id="arr-blue" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0,8 3,0 6" fill="#0070d2"/>
    </marker>
    <marker id="arr-orange" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0,8 3,0 6" fill="#e67e22"/>
    </marker>
    <marker id="arr-purple" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0,8 3,0 6" fill="#7e3af2"/>
    </marker>
    <marker id="arr-gray" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0,8 3,0 6" fill="#868e96"/>
    </marker>
    <!-- Dashed boundary clip path decoration -->
  </defs>

  <!-- ─── BACKGROUND ─── -->
  <rect width="960" height="760" fill="#f8f9fa" rx="12"/>
  <rect x="1" y="1" width="958" height="758" fill="none" stroke="#dee2e6" stroke-width="1.5" rx="12"/>

  <!-- ─── HEADER ─── -->
  <rect x="0" y="0" width="960" height="56" fill="#7e3af2" rx="12"/>
  <rect x="0" y="44" width="960" height="12" fill="#7e3af2"/>
  <text x="480" y="24" text-anchor="middle" class="title">Shadow DOM Anatomy</text>
  <text x="480" y="43" text-anchor="middle" class="subtitle">Shadow Host · Shadow Root · Shadow Tree · Slots · Light DOM · CSS Encapsulation</text>

  <!-- ═══════════════════════════════════════════════════════════════ -->
  <!--  LEFT PANEL — DOM Tree Visualization                            -->
  <!-- ═══════════════════════════════════════════════════════════════ -->

  <!-- Panel background -->
  <rect x="16" y="68" width="560" height="556" fill="#ffffff" rx="8" stroke="#dee2e6" stroke-width="1"/>
  <!-- Panel header -->
  <rect x="16" y="68" width="560" height="30" fill="#f3eeff" rx="8"/>
  <rect x="16" y="86" width="560" height="12" fill="#f3eeff"/>
  <text x="296" y="88" text-anchor="middle" class="section-h" fill="#7e3af2">DOM Tree Structure</text>

  <!-- ── DOCUMENT ── -->
  <rect x="36" y="108" width="120" height="28" fill="#0070d2" rx="5"/>
  <text x="96" y="127" text-anchor="middle" class="tag-label">document</text>

  <!-- connector: document → html -->
  <line x1="96" y1="136" x2="96" y2="152" stroke="#adb5bd" stroke-width="1.5" stroke-dasharray="4,3"/>

  <!-- ── HTML ── -->
  <rect x="60" y="152" width="72" height="26" fill="#0070d2" rx="4"/>
  <text x="96" y="170" text-anchor="middle" class="tag-label">&lt;html&gt;</text>
  <!-- connector: html → body -->
  <line x1="96" y1="178" x2="96" y2="194" stroke="#adb5bd" stroke-width="1.5" stroke-dasharray="4,3"/>

  <!-- ── BODY ── -->
  <rect x="60" y="194" width="72" height="26" fill="#0070d2" rx="4"/>
  <text x="96" y="212" text-anchor="middle" class="tag-label">&lt;body&gt;</text>
  <!-- connector: body → shadow host -->
  <line x1="96" y1="220" x2="96" y2="238" stroke="#adb5bd" stroke-width="1.5" stroke-dasharray="4,3"/>

  <!-- ── SHADOW HOST ── -->
  <!-- Outer box label -->
  <rect x="28" y="238" width="510" height="362" fill="#fff8e1" rx="8" stroke="#f39c12" stroke-width="2" stroke-dasharray="6,3"/>
  <rect x="28" y="238" width="136" height="22" fill="#f39c12" rx="4"/>
  <text x="38" y="253" class="tag-label" fill="#ffffff">Shadow Host</text>
  <!-- Component tag -->
  <rect x="44" y="268" width="200" height="28" fill="#e67e22" rx="5"/>
  <text x="144" y="287" text-anchor="middle" class="tag-label">&lt;c-my-component&gt;</text>

  <!-- Light DOM children label + bracket -->
  <rect x="260" y="262" width="120" height="20" fill="#fff3cd" rx="3" stroke="#f39c12" stroke-width="1"/>
  <text x="320" y="276" text-anchor="middle" font-size="10" font-weight="700" fill="#856404">Light DOM (slotted)</text>

  <!-- Light DOM child 1 -->
  <rect x="260" y="290" width="90" height="24" fill="#ffeeba" rx="4" stroke="#f39c12" stroke-width="1"/>
  <text x="305" y="307" text-anchor="middle" font-size="11" font-family="'Cascadia Code',monospace" fill="#495057">&lt;span&gt; Title&lt;/span&gt;</text>
  <!-- Light DOM child 2 -->
  <rect x="360" y="290" width="120" height="24" fill="#ffeeba" rx="4" stroke="#f39c12" stroke-width="1"/>
  <text x="420" y="307" text-anchor="middle" font-size="11" font-family="'Cascadia Code',monospace" fill="#495057">&lt;p slot="footer"&gt;</text>

  <!-- Connector host → shadow root -->
  <line x1="96" y1="296" x2="96" y2="316" stroke="#7e3af2" stroke-width="2" marker-end="url(#arr-purple)"/>
  <text x="100" y="310" class="label-sm" fill="#7e3af2">attachShadow()</text>

  <!-- ── SHADOW BOUNDARY ── -->
  <rect x="36" y="318" width="490" height="270" fill="#f9f0ff" rx="6" stroke="#7e3af2" stroke-width="2" stroke-dasharray="8,4"/>
  <rect x="36" y="318" width="126" height="20" fill="#7e3af2" rx="4"/>
  <text x="46" y="332" class="tag-label">Shadow Boundary</text>
  <!-- Lock icon (simple) -->
  <rect x="170" y="321" width="14" height="10" fill="none" stroke="#7e3af2" stroke-width="1.5" rx="2"/>
  <path d="M173 321 v-4 a4 4 0 0 1 8 0 v4" fill="none" stroke="#7e3af2" stroke-width="1.5"/>

  <!-- ── SHADOW ROOT ── -->
  <rect x="52" y="346" width="130" height="26" fill="#7e3af2" rx="5"/>
  <text x="117" y="364" text-anchor="middle" class="tag-label">#shadow-root</text>

  <!-- connector: shadow root → shadow tree items -->
  <line x1="117" y1="372" x2="117" y2="390" stroke="#7e3af2" stroke-width="1.5" stroke-dasharray="4,3"/>

  <!-- ── SHADOW TREE ── (3 children) -->
  <rect x="52" y="390" width="460" height="180" fill="#f0e6ff" rx="6" stroke="#c4a0f5" stroke-width="1.5"/>
  <text x="72" y="406" class="label-sm" fill="#7e3af2">Shadow Tree (internal, encapsulated)</text>

  <!-- ── header ── -->
  <rect x="64" y="414" width="100" height="26" fill="#7e3af2" rx="4"/>
  <text x="114" y="432" text-anchor="middle" class="tag-label">&lt;header&gt;</text>
  <!-- child of header -->
  <rect x="74" y="448" width="80" height="22" fill="#c4a0f5" rx="3"/>
  <text x="114" y="463" text-anchor="middle" font-size="11" font-family="'Cascadia Code',monospace" fill="#3c1874">&lt;h2&gt;Title&lt;/h2&gt;</text>

  <!-- ── default slot ── -->
  <rect x="200" y="414" width="130" height="26" fill="#1e7e34" rx="4"/>
  <text x="265" y="432" text-anchor="middle" class="tag-label">&lt;slot&gt; (default)</text>
  <!-- projected content arrow -->
  <line x1="305" y1="290" x2="305" y2="414" stroke="#e67e22" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arr-orange)"/>
  <text x="320" y="360" font-size="10" fill="#e67e22" font-style="italic">projected</text>
  <!-- slot content visual -->
  <rect x="210" y="448" width="110" height="22" fill="#d4edda" rx="3" stroke="#1e7e34" stroke-width="1"/>
  <text x="265" y="463" text-anchor="middle" font-size="10" font-family="'Cascadia Code',monospace" fill="#155724">↳ &lt;span&gt; Title &lt;/span&gt;</text>

  <!-- ── named slot ── -->
  <rect x="360" y="414" width="140" height="26" fill="#1e7e34" rx="4"/>
  <text x="430" y="432" text-anchor="middle" class="tag-label">&lt;slot name="footer"&gt;</text>
  <!-- projected content arrow from footer light DOM child -->
  <line x1="420" y1="314" x2="430" y2="414" stroke="#e67e22" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arr-orange)"/>
  <!-- slot content visual -->
  <rect x="362" y="448" width="136" height="22" fill="#d4edda" rx="3" stroke="#1e7e34" stroke-width="1"/>
  <text x="430" y="463" text-anchor="middle" font-size="10" font-family="'Cascadia Code',monospace" fill="#155724">↳ &lt;p slot="footer"&gt;...&lt;/p&gt;</text>

  <!-- ── footer ── -->
  <rect x="64" y="478" width="100" height="26" fill="#7e3af2" rx="4"/>
  <text x="114" y="496" text-anchor="middle" class="tag-label">&lt;footer&gt;</text>
  <!-- child of footer -->
  <rect x="74" y="511" width="80" height="22" fill="#c4a0f5" rx="3"/>
  <text x="114" y="526" text-anchor="middle" font-size="11" font-family="'Cascadia Code',monospace" fill="#3c1874">&lt;p&gt;...&lt;/p&gt;</text>

  <!-- CSS isolation note inside shadow tree -->
  <rect x="200" y="480" width="310" height="30" fill="#ede0ff" rx="4" stroke="#c4a0f5" stroke-width="1"/>
  <text x="355" y="497" text-anchor="middle" font-size="10.5" fill="#7e3af2">CSS rules from outside cannot penetrate this boundary</text>
  <text x="355" y="510" text-anchor="middle" font-size="10" fill="#6c757d">(except CSS custom properties / Styling Hooks)</text>

  <!-- ═══════════════════════════════════════════════════════════════ -->
  <!--  RIGHT PANEL — Key Concepts Reference                           -->
  <!-- ═══════════════════════════════════════════════════════════════ -->

  <rect x="592" y="68" width="352" height="556" fill="#ffffff" rx="8" stroke="#dee2e6" stroke-width="1"/>
  <rect x="592" y="68" width="352" height="30" fill="#f3eeff" rx="8"/>
  <rect x="592" y="86" width="352" height="12" fill="#f3eeff"/>
  <text x="768" y="88" text-anchor="middle" class="section-h" fill="#7e3af2">Key Concepts</text>

  <!-- Concept 1: Shadow Host -->
  <rect x="604" y="108" width="328" height="66" fill="#fff8e1" rx="6" stroke="#f39c12" stroke-width="1.5"/>
  <rect x="604" y="108" width="100" height="20" fill="#f39c12" rx="4"/>
  <text x="612" y="122" class="tag-label">Shadow Host</text>
  <text x="614" y="142" class="key-label">The regular DOM element that "owns"</text>
  <text x="614" y="157" class="key-desc">the shadow tree. In LWC, every component</text>
  <text x="614" y="170" class="key-desc">element is automatically a shadow host.</text>

  <!-- Concept 2: Shadow Root -->
  <rect x="604" y="184" width="328" height="66" fill="#f9f0ff" rx="6" stroke="#7e3af2" stroke-width="1.5"/>
  <rect x="604" y="184" width="100" height="20" fill="#7e3af2" rx="4"/>
  <text x="612" y="198" class="tag-label">Shadow Root</text>
  <text x="614" y="218" class="key-label">The root node of the shadow tree, returned</text>
  <text x="614" y="233" class="key-desc">by attachShadow(). In LWC, the platform creates</text>
  <text x="614" y="246" class="key-desc">this automatically (Synthetic Shadow DOM).</text>

  <!-- Concept 3: Shadow Tree -->
  <rect x="604" y="260" width="328" height="66" fill="#f9f0ff" rx="6" stroke="#c4a0f5" stroke-width="1.5"/>
  <rect x="604" y="260" width="100" height="20" fill="#c4a0f5" rx="4"/>
  <text x="612" y="274" class="tag-label" fill="#3c1874">Shadow Tree</text>
  <text x="614" y="294" class="key-label">The private internal DOM of the component.</text>
  <text x="614" y="309" class="key-desc">Defined in the LWC .html template file.</text>
  <text x="614" y="322" class="key-desc">Isolated from external querySelector() calls.</text>

  <!-- Concept 4: Slot -->
  <rect x="604" y="336" width="328" height="80" fill="#f0fff4" rx="6" stroke="#1e7e34" stroke-width="1.5"/>
  <rect x="604" y="336" width="100" height="20" fill="#1e7e34" rx="4"/>
  <text x="612" y="350" class="tag-label">Slot (Content Projection)</text>
  <text x="614" y="370" class="key-label">Placeholder in shadow tree for Light DOM content.</text>
  <text x="614" y="384" class="key-desc">&lt;slot&gt; = default slot (unnamed content)</text>
  <text x="614" y="398" class="key-desc">&lt;slot name="footer"&gt; = named slot</text>
  <text x="614" y="412" class="key-desc">Slotted content stays in Light DOM; only "projected".</text>

  <!-- Concept 5: Light DOM -->
  <rect x="604" y="426" width="328" height="66" fill="#fff8e1" rx="6" stroke="#e67e22" stroke-width="1.5"/>
  <rect x="604" y="426" width="100" height="20" fill="#e67e22" rx="4"/>
  <text x="612" y="440" class="tag-label">Light DOM Children</text>
  <text x="614" y="460" class="key-label">Children passed to the component by its parent.</text>
  <text x="614" y="475" class="key-desc">They live in the parent's DOM tree, not the shadow.</text>
  <text x="614" y="489" class="key-desc">Can be targeted by parent's CSS and querySelector.</text>

  <!-- Concept 6: CSS & Event rules -->
  <rect x="604" y="502" width="328" height="110" fill="#e8f4fd" rx="6" stroke="#0070d2" stroke-width="1.5"/>
  <rect x="604" y="502" width="180" height="20" fill="#0070d2" rx="4"/>
  <text x="612" y="516" class="tag-label">CSS &amp; Event Boundary Rules</text>
  <!-- CSS rules -->
  <text x="614" y="536" font-size="11" font-weight="700" fill="#0d1117">CSS:</text>
  <text x="640" y="536" class="key-desc">External styles cannot enter shadow tree</text>
  <text x="640" y="549" class="key-desc">CSS vars / Styling Hooks CAN penetrate</text>
  <text x="640" y="562" class="key-desc">:host, ::slotted() select across boundary</text>
  <!-- Event rules -->
  <text x="614" y="578" font-size="11" font-weight="700" fill="#0d1117">Events:</text>
  <text x="648" y="578" class="key-desc">event.target is retargeted at shadow boundary</text>
  <text x="648" y="591" class="key-desc">composed:true → bubbles across boundary</text>
  <text x="648" y="604" class="key-desc">composed:false → stops at shadow root</text>

  <!-- ─── BOTTOM ROW: Synthetic vs Native Shadow DOM ─── -->
  <rect x="16" y="634" width="928" height="108" fill="#ffffff" rx="8" stroke="#dee2e6" stroke-width="1"/>
  <rect x="16" y="634" width="928" height="28" fill="#e8f4fd" rx="8"/>
  <rect x="16" y="650" width="928" height="12" fill="#e8f4fd"/>
  <text x="480" y="652" text-anchor="middle" class="section-h" fill="#0070d2">Synthetic Shadow DOM (Salesforce) vs Native Shadow DOM (Browser)</text>

  <!-- Synthetic column -->
  <rect x="26" y="666" width="440" height="68" fill="#f8f9fa" rx="5" stroke="#0070d2" stroke-width="1"/>
  <text x="246" y="682" text-anchor="middle" font-size="12" font-weight="700" fill="#0070d2">Salesforce: Synthetic Shadow DOM</text>
  <text x="36" y="698" font-size="11" fill="#495057">• Polyfill running in userspace (not native browser API)</text>
  <text x="36" y="712" font-size="11" fill="#495057">• All components share same document (no true isolation between orgs)</text>
  <text x="36" y="726" font-size="11" fill="#495057">• Retargeting and CSS scoping emulated via attribute selectors at compile time</text>

  <!-- Native column -->
  <rect x="474" y="666" width="460" height="68" fill="#f8f9fa" rx="5" stroke="#7e3af2" stroke-width="1"/>
  <text x="704" y="682" text-anchor="middle" font-size="12" font-weight="700" fill="#7e3af2">Browser: Native Shadow DOM (Light DOM mode)</text>
  <text x="484" y="698" font-size="11" fill="#495057">• True shadow root created by browser (shadowRoot property)</text>
  <text x="484" y="712" font-size="11" fill="#495057">• Enabled in LWC with: static renderMode = 'light' (Light DOM opt-out)</text>
  <text x="484" y="726" font-size="11" fill="#495057">• Allows external CSS targeting, scoped slots, 3rd-party JS DOM access</text>
</svg>
