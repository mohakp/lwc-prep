<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 960 720" width="960" height="720" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <marker id="arr-white" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0,8 3,0 6" fill="#ffffff"/>
    </marker>
    <marker id="arr-blue" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0,8 3,0 6" fill="#0070d2"/>
    </marker>
    <marker id="arr-green" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0,8 3,0 6" fill="#1e7e34"/>
    </marker>
    <marker id="arr-orange" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0,8 3,0 6" fill="#e67e22"/>
    </marker>
    <marker id="arr-gray" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0,8 3,0 6" fill="#868e96"/>
    </marker>
  </defs>

  <!-- BACKGROUND -->
  <rect width="960" height="720" fill="#f8f9fa" rx="12"/>
  <rect x="1" y="1" width="958" height="718" fill="none" stroke="#dee2e6" stroke-width="1.5" rx="12"/>

  <!-- HEADER -->
  <rect x="0" y="0" width="960" height="56" fill="#0070d2" rx="12"/>
  <rect x="0" y="44" width="960" height="12" fill="#0070d2"/>
  <text x="480" y="25" text-anchor="middle" font-size="17" font-weight="700" fill="#ffffff">Salesforce Data Access Layer Stack</text>
  <text x="480" y="43" text-anchor="middle" font-size="11" fill="#c8e0f8">REST API → UI API → Lightning Data Service → Wire Adapters → LWC Component</text>

  <!-- ══════════════════════════════════════════ -->
  <!--  LEFT: Stack Layers (main visualization)   -->
  <!-- ══════════════════════════════════════════ -->

  <!-- Layer 1 — Salesforce Database / Server -->
  <rect x="80" y="76" width="420" height="72" fill="#1e3a5f" rx="8"/>
  <text x="290" y="102" text-anchor="middle" font-size="15" font-weight="700" fill="#ffffff">Salesforce Database + Apex Server</text>
  <text x="290" y="120" text-anchor="middle" font-size="11" fill="#8bb8e8">SOQL · DML · Apex classes · Triggers · Validation Rules</text>
  <text x="290" y="136" text-anchor="middle" font-size="10" fill="#adb5bd">FLS · CRUD · Sharing Rules enforced at this level</text>

  <!-- Arrow down -->
  <line x1="290" y1="148" x2="290" y2="166" stroke="#adb5bd" stroke-width="2" marker-end="url(#arr-gray)"/>
  <text x="310" y="161" font-size="10" fill="#6c757d">exposes</text>

  <!-- Layer 2 — REST / Connect API -->
  <rect x="80" y="166" width="420" height="62" fill="#0a4480" rx="8"/>
  <text x="290" y="191" text-anchor="middle" font-size="14" font-weight="700" fill="#ffffff">REST API / Connect API</text>
  <text x="290" y="208" text-anchor="middle" font-size="11" fill="#8bb8e8">GET /services/data/v60.0/sobjects/Account/{id}</text>
  <text x="290" y="222" text-anchor="middle" font-size="10" fill="#adb5bd">HTTP JSON responses · OAuth / Session-based auth</text>

  <!-- Arrow down -->
  <line x1="290" y1="228" x2="290" y2="246" stroke="#adb5bd" stroke-width="2" marker-end="url(#arr-gray)"/>
  <text x="310" y="241" font-size="10" fill="#6c757d">wraps</text>

  <!-- Layer 3 — UI API -->
  <rect x="80" y="246" width="420" height="72" fill="#0070d2" rx="8"/>
  <text x="290" y="271" text-anchor="middle" font-size="14" font-weight="700" fill="#ffffff">UI API</text>
  <text x="290" y="288" text-anchor="middle" font-size="11" fill="#c8e0f8">GET /ui-api/record-ui/{recordId}</text>
  <text x="290" y="303" text-anchor="middle" font-size="10.5" fill="#c8e0f8">Combines record data + object metadata + layout in one call</text>
  <text x="290" y="316" text-anchor="middle" font-size="10" fill="#adb5bd">Respects FLS · Returns display-ready field values</text>

  <!-- Arrow down -->
  <line x1="290" y1="318" x2="290" y2="336" stroke="#adb5bd" stroke-width="2" marker-end="url(#arr-gray)"/>
  <text x="310" y="331" font-size="10" fill="#6c757d">powers</text>

  <!-- Layer 4 — Lightning Data Service (LDS) -->
  <rect x="80" y="336" width="420" height="78" fill="#1e7e34" rx="8"/>
  <text x="290" y="361" text-anchor="middle" font-size="14" font-weight="700" fill="#ffffff">Lightning Data Service (LDS)</text>
  <text x="290" y="378" text-anchor="middle" font-size="11" fill="#d4edda">Client-side shared cache · Auto field merging · Cache invalidation</text>
  <text x="290" y="394" text-anchor="middle" font-size="10.5" fill="#d4edda">Batches multiple component requests into one UI API call</text>
  <text x="290" y="409" text-anchor="middle" font-size="10" fill="#b8dabe">Shared across all components on the page automatically</text>

  <!-- Arrow down -->
  <line x1="290" y1="414" x2="290" y2="432" stroke="#adb5bd" stroke-width="2" marker-end="url(#arr-gray)"/>
  <text x="310" y="427" font-size="10" fill="#6c757d">exposes</text>

  <!-- Layer 5 — Wire Adapters -->
  <rect x="80" y="432" width="420" height="82" fill="#7e3af2" rx="8"/>
  <text x="290" y="457" text-anchor="middle" font-size="14" font-weight="700" fill="#ffffff">Wire Adapters (lightning/uiRecordApi)</text>
  <text x="290" y="474" text-anchor="middle" font-size="10.5" fill="#e9d8fd">getRecord · getListUi · getObjectInfo · getPicklistValues</text>
  <text x="290" y="490" text-anchor="middle" font-size="10.5" fill="#e9d8fd">createRecord · updateRecord · deleteRecord</text>
  <text x="290" y="505" text-anchor="middle" font-size="10" fill="#c4a0f5">notifyRecordUpdateAvailable() — bridge imperative Apex → LDS cache</text>

  <!-- Arrow down -->
  <line x1="290" y1="514" x2="290" y2="532" stroke="#adb5bd" stroke-width="2" marker-end="url(#arr-gray)"/>
  <text x="310" y="527" font-size="10" fill="#6c757d">used in</text>

  <!-- Layer 6 — LWC Component -->
  <rect x="80" y="532" width="420" height="62" fill="#e67e22" rx="8"/>
  <text x="290" y="557" text-anchor="middle" font-size="14" font-weight="700" fill="#ffffff">LWC Component</text>
  <text x="290" y="574" text-anchor="middle" font-size="10.5" fill="#fef3e2">@wire(getRecord, &#123; recordId: '$recordId', fields &#125;) wiredRecord;</text>
  <text x="290" y="589" text-anchor="middle" font-size="10" fill="#f5cba7">Reactive binding — re-renders when cache updates</text>

  <!-- ══════════════════════════════════════════════════ -->
  <!--  RIGHT PANEL — When to Use What                    -->
  <!-- ══════════════════════════════════════════════════ -->

  <rect x="524" y="76" width="420" height="518" fill="#ffffff" rx="8" stroke="#dee2e6" stroke-width="1"/>
  <rect x="524" y="76" width="420" height="28" fill="#e8f4fd" rx="8"/>
  <rect x="524" y="92" width="420" height="12" fill="#e8f4fd"/>
  <text x="734" y="94" text-anchor="middle" font-size="13" font-weight="700" fill="#0070d2">Decision Framework: Which Layer to Use?</text>

  <!-- Wire/LDS block -->
  <rect x="534" y="112" width="400" height="112" fill="#f0fff4" rx="6" stroke="#1e7e34" stroke-width="1.5"/>
  <rect x="534" y="112" width="240" height="20" fill="#1e7e34" rx="4"/>
  <text x="542" y="126" font-size="11" font-weight="700" fill="#ffffff">Use @wire + LDS when...</text>
  <text x="544" y="146" font-size="11" fill="#155724">✓  Standard SObject (Account, Contact, Opportunity...)</text>
  <text x="544" y="161" font-size="11" fill="#155724">✓  Single record view or edit (recordId available)</text>
  <text x="544" y="176" font-size="11" fill="#155724">✓  Field-level security auto-enforcement needed</text>
  <text x="544" y="191" font-size="11" fill="#155724">✓  Automatic cache sharing across page components</text>
  <text x="544" y="206" font-size="11" fill="#155724">✓  No custom SOQL logic required</text>

  <!-- Cacheable Apex wire block -->
  <rect x="534" y="234" width="400" height="98" fill="#e8f4fd" rx="6" stroke="#0070d2" stroke-width="1.5"/>
  <rect x="534" y="234" width="260" height="20" fill="#0070d2" rx="4"/>
  <text x="542" y="248" font-size="11" font-weight="700" fill="#ffffff">Use @wire(ApexMethod) when...</text>
  <text x="544" y="268" font-size="11" fill="#004085">✓  Custom SOQL with multi-object queries</text>
  <text x="544" y="283" font-size="11" fill="#004085">✓  Complex business logic server-side</text>
  <text x="544" y="298" font-size="11" fill="#004085">✓  Method decorated @AuraEnabled(cacheable=true)</text>
  <text x="544" y="313" font-size="11" fill="#004085">✓  Reactive params needed ($recordId, $searchTerm)</text>

  <!-- Imperative Apex block -->
  <rect x="534" y="342" width="400" height="112" fill="#fff8e1" rx="6" stroke="#f39c12" stroke-width="1.5"/>
  <rect x="534" y="342" width="260" height="20" fill="#f39c12" rx="4"/>
  <text x="542" y="356" font-size="11" font-weight="700" fill="#ffffff">Use Imperative Apex when...</text>
  <text x="544" y="376" font-size="11" fill="#856404">✓  DML operations (non-cacheable: insert/update/delete)</text>
  <text x="544" y="391" font-size="11" fill="#856404">✓  User action triggered (button click, form submit)</text>
  <text x="544" y="406" font-size="11" fill="#856404">✓  Need try/catch + loading spinner control</text>
  <text x="544" y="421" font-size="11" fill="#856404">✓  Complex conditional logic before/after call</text>
  <text x="544" y="436" font-size="11" fill="#856404">✓  Task, Event, or unsupported objects (LDS gap)</text>

  <!-- notifyRecordUpdateAvailable block -->
  <rect x="534" y="464" width="400" height="66" fill="#f9f0ff" rx="6" stroke="#7e3af2" stroke-width="1.5"/>
  <rect x="534" y="464" width="290" height="20" fill="#7e3af2" rx="4"/>
  <text x="542" y="478" font-size="11" font-weight="700" fill="#ffffff">After Imperative Apex DML → refresh LDS:</text>
  <text x="544" y="498" font-size="11" font-family="'Cascadia Code',monospace" fill="#3c1874">import &#123; notifyRecordUpdateAvailable &#125;</text>
  <text x="544" y="512" font-size="11" font-family="'Cascadia Code',monospace" fill="#3c1874">  from 'lightning/uiRecordApi';</text>
  <text x="544" y="526" font-size="10" fill="#6c757d">Tells LDS cache the record changed → all @wire adapters auto-refresh</text>

  <!-- refreshApex block -->
  <rect x="534" y="540" width="400" height="46" fill="#fff3cd" rx="6" stroke="#ffc107" stroke-width="1.5"/>
  <rect x="534" y="540" width="130" height="20" fill="#ffc107" rx="4"/>
  <text x="542" y="554" font-size="11" font-weight="700" fill="#212529">refreshApex()</text>
  <text x="544" y="570" font-size="11" fill="#856404">Pass the wiredResult object (not .data) → re-runs the @wire call</text>
  <text x="544" y="582" font-size="10" fill="#6c757d">import &#123; refreshApex &#125; from '@salesforce/apex'; refreshApex(this.wiredRecord);</text>

  <!-- ──────────────── BOTTOM LEGEND ──────────────── -->
  <rect x="16" y="612" width="928" height="90" fill="#ffffff" rx="8" stroke="#dee2e6" stroke-width="1"/>
  <rect x="16" y="612" width="928" height="26" fill="#e8f4fd" rx="8"/>
  <rect x="16" y="626" width="928" height="12" fill="#e8f4fd"/>
  <text x="480" y="628" text-anchor="middle" font-size="13" font-weight="700" fill="#0070d2">Important Gotchas</text>

  <text x="30" y="651" font-size="11" font-weight="700" fill="#0d1117">@AuraEnabled(cacheable=true) constraints:</text>
  <text x="30" y="665" font-size="11" fill="#495057">• Cannot perform DML, send emails, or call callouts in a cacheable method</text>
  <text x="30" y="679" font-size="11" fill="#495057">• Results cached in LDS — stale until refreshApex() or record changes via LDS</text>

  <text x="500" y="651" font-size="11" font-weight="700" fill="#0d1117">getFieldValue() vs direct property access:</text>
  <text x="500" y="665" font-size="11" fill="#495057">• getFieldValue(record, FIELD) handles polymorphic fields, null safety, field type</text>
  <text x="500" y="679" font-size="11" fill="#495057">• Direct: record.fields.Name.value — fails if field not in @wire fields array</text>
</svg>
